  - platform: template
    switches:
      multimedia:
        value_template: "{{ not is_state('media_player.tv', 'off') and not is_state('media_player.xbox', 'off')}}"
        turn_on:          
          service: script.media_on
        turn_off:
        - service: media_player.turn_off
          data:
            entity_id: media_player.tv
        - service: media_player.turn_off
          data:
            entity_id: media_player.xbox
      sonos_living_and_kitchen:
        friendly_name: Sonos Living and Kitchen
        value_template: "{{ states.media_player.living_room.attributes.sonos_group | count == 2 and 'media_player.kitchen' in states.media_player.living_room.attributes.sonos_group }}"
        turn_on:
          service: media_player.sonos_join
          data:
            master: media_player.living_room
            entity_id: media_player.kitchen
        turn_off:
          service: media_player.sonos_unjoin
        icon_template: >-
          {% if states.media_player.living_room.attributes.sonos_group | count > 1 %}
            mdi:speaker-multiple
          {% else %}
            mdi:speaker
          {% endif %}
      sonos_everywhere_tv:
        friendly_name: TV Everywhere
        value_template: "{{ states.media_player.living_room.attributes.sonos_group | count == 3 
        and states.media_player.living_room.attributes.source == 'TV' }}"
        turn_on:
          - service: media_player.sonos_join
            data:
              master: media_player.living_room
              entity_id: 
                - media_player.kitchen
                - media_player.study
        turn_off:
          service: media_player.sonos_unjoin
        icon_template: >-
          {% if states.media_player.living_room.attributes.sonos_group | count == 3 %}
          {% if states.media_player.living_room.attributes.source == 'TV' %}
            mdi:television
          {% else %}
            mdi:speaker-multiple
          {% endif %}
          {% else %}
            mdi:speaker
          {% endif %}
      sonos_everywhere_records:
        friendly_name: Records Everywhere
        value_template: "{{ states.media_player.study.attributes.sonos_group | count == 3 
        and states.media_player.study.attributes.source == 'Line-in' }}"
        turn_on:
          - service: media_player.sonos_join
            data:
              master: media_player.study
              entity_id: 
                - media_player.kitchen
                - media_player.living_room
          - service: media_player.select_source
            data:
              entity_id: media_player.study
              source: 'Line-in'
        turn_off:
          service: media_player.sonos_unjoin
        icon_template: >-
          {% if states.media_player.study.attributes.sonos_group | count == 3 %}
          {% if states.media_player.study.attributes.sonos_group[0] == 'media_player.study' 
          and states.media_player.study.attributes.source == 'Line-in' %}
            mdi:record-player
          {% else %}
            mdi:speaker-multiple
          {% endif %}
          {% else %}
            mdi:speaker
          {% endif %}
